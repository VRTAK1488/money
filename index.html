<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Banda Vonyuchiy Veter</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #fffbe6, #fff5cc);
      color: #333;
      font-family: 'Arial Black', sans-serif;
      overflow: hidden;
      height: 100vh;
      position: relative;
    }

    /* === ADMIN === */
    #control-panel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 100;
      background: #fff;
      padding: 28px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      width: 92%;
      max-width: 520px;
      text-align: center;
    }

    .logo-control {
      font-size: 2.0em;
      color: #d4af37;
      margin-bottom: 18px;
      letter-spacing: 1px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      text-align: left;
      margin-top: 8px;
    }

    .field label {
      display: block;
      font-size: 12px;
      letter-spacing: 0.6px;
      color: #666;
      margin: 0 0 6px 2px;
      text-transform: uppercase;
    }

    select, input, button {
      width: 100%;
      padding: 14px 14px;
      border-radius: 12px;
      border: 2px solid #ddd;
      font-size: 16px;
      transition: border-color 0.3s, box-shadow 0.3s;
      height: 52px;
      background: #fff;
    }

    input[type="number"] {
      appearance: textfield;
      -webkit-appearance: none;
      -moz-appearance: textfield;
      font-size: 18px;
      text-align: center;
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #d4af37;
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.18);
    }

    .hint {
      font-family: Arial, sans-serif;
      font-weight: 600;
      font-size: 12px;
      color: #888;
      margin-top: -4px;
      text-align: center;
    }

    button {
      background: linear-gradient(to right, #d4af37, #ffcc00);
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border: none;
      font-size: 18px;
      margin-top: 6px;
    }

    button:hover {
      transform: scale(1.02);
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.35);
    }

    .admin-status {
      margin-top: 10px;
      font-family: Arial, sans-serif;
      font-size: 12px;
      color: #777;
      text-align: center;
    }

    /* === TV ALERT SCREEN === */
    #alert-screen {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
      background: linear-gradient(135deg, #fffbe6, #fff5cc);
      padding: 24px;
    }

    #particles {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    /* ===== PREMIUM COINS ===== */
    .particle {
      position: absolute;
      opacity: 0;
      animation-name: fall;
      animation-timing-function: ease-in;
      animation-iteration-count: infinite;
      will-change: transform, opacity;
    }

    .coin {
      width: var(--size, 36px);
      height: var(--size, 36px);
      border-radius: 999px;
      position: relative;
      display: grid;
      place-items: center;
      user-select: none;

      /* premium metal */
      background:
        radial-gradient(circle at 28% 24%, rgba(255,255,255,0.95), rgba(255,255,255,0.0) 42%),
        radial-gradient(circle at 72% 78%, rgba(0,0,0,0.22), rgba(0,0,0,0.0) 50%),
        linear-gradient(145deg, var(--c1, #ffd86a), var(--c2, #ff9a1f));
      border: 2px solid rgba(255,255,255,0.55);
      outline: 2px solid rgba(0,0,0,0.10);
      outline-offset: -5px;

      box-shadow:
        0 18px 28px rgba(0,0,0,0.20),
        0 0 26px rgba(255,255,255,0.12),
        inset 0 2px 10px rgba(255,255,255,0.55),
        inset 0 -16px 26px rgba(0,0,0,0.22);

      /* 3D vibe */
      transform:
        perspective(800px)
        rotateX(var(--rx, 14deg))
        rotateY(var(--ry, -10deg));
      filter: drop-shadow(0 10px 10px rgba(0,0,0,0.16));
    }

    /* big glow for huge mode */
    .coin.huge {
      box-shadow:
        0 22px 34px rgba(0,0,0,0.22),
        0 0 44px rgba(255,255,255,0.22),
        0 0 60px rgba(255, 180, 0, 0.22),
        inset 0 2px 10px rgba(255,255,255,0.6),
        inset 0 -18px 30px rgba(0,0,0,0.22);
    }

    /* shine streak */
    .coin::before{
      content:"";
      position:absolute;
      width: 78%;
      height: 18%;
      top: 16%;
      left: 11%;
      border-radius: 999px;
      background: rgba(255,255,255,0.70);
      transform: rotate(-14deg);
      filter: blur(0.6px);
      opacity: 0.78;
    }

    /* engraved inner ring */
    .coin::after{
      content:"";
      position:absolute;
      inset: 16%;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,0.16);
      box-shadow:
        inset 0 0 0 2px rgba(0,0,0,0.08),
        inset 0 6px 14px rgba(255,255,255,0.06);
      opacity: 0.95;
    }

    .coin span{
      position: relative;
      z-index: 2;
      font-weight: 1000;
      font-size: calc(var(--size, 36px) * 0.56);
      letter-spacing: -0.03em;

      /* embossed symbol */
      color: rgba(0,0,0,0.32);
      text-shadow:
        0 2px 2px rgba(0,0,0,0.16),
        0 -1px 0 rgba(255,255,255,0.55),
        0 0 18px rgba(255,255,255,0.22);
      mix-blend-mode: multiply;
    }

    .coin.btc  { --c1:#ffe08a; --c2:#ff8a00; }
    .coin.usdt { --c1:#a7f3d0; --c2:#10b981; }
    .coin.eth  { --c1:#dbeafe; --c2:#6366f1; }
    .coin.coin { --c1:#fff1a8; --c2:#f59e0b; }

    @keyframes fall {
      0%   { transform: translateY(-160px) translateX(var(--drift, 0px)) rotate(0deg); opacity: 0; }
      10%  { opacity: 1; }
      90%  { opacity: 0.98; }
      100% { transform: translateY(115vh) translateX(calc(var(--drift, 0px) * 2)) rotate(var(--rot, 420deg)); opacity: 0; }
    }

    .content {
      position: relative;
      z-index: 10;
      text-align: center;
      padding: 0 18px;
      max-width: 1100px;
      width: 100%;
    }

    .logo-alert {
      font-size: 2.6em;
      margin-bottom: 18px;
      color: #d4af37;
      text-shadow: 0 2px 6px rgba(212, 175, 55, 0.3);
      letter-spacing: 2px;
    }

    #manager-name {
      font-size: clamp(2.6em, 6vw, 5.0em);
      margin: 10px 0;
      color: #d4af37;
      text-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
      animation: pulse 2s infinite alternate;
      word-break: break-word;
    }

    @keyframes pulse {
      from { text-shadow: 0 0 20px rgba(212, 175, 55, 0.6); }
      to   { text-shadow: 0 0 40px #d4af37; }
    }

    #amountDisplay {
      font-size: clamp(2.2em, 5vw, 4.0em);
      color: #ff9900;
      margin: 12px 0;
      text-shadow: 0 0 15px rgba(255, 153, 0, 0.5);
      font-weight: 900;
      background: rgba(255, 255, 255, 0.35);
      padding: 12px 22px;
      border-radius: 14px;
      display: inline-block;
      border: 2px solid rgba(255, 153, 0, 0.25);
    }

    #geo {
      font-size: clamp(1.4em, 3vw, 2.2em);
      color: #777;
      margin-top: 14px;
      font-family: Arial, sans-serif;
      font-weight: 800;
      letter-spacing: 0.6px;
    }

    /* Sound overlay */
    #sound-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: rgba(0,0,0,0.55);
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 24px;
    }

    #sound-overlay .box {
      background: #fff;
      border-radius: 18px;
      padding: 22px;
      max-width: 520px;
      width: 92%;
      box-shadow: 0 10px 40px rgba(0,0,0,0.25);
      font-family: Arial, sans-serif;
      font-weight: 800;
    }

    #sound-overlay .box h2 {
      margin-bottom: 10px;
      color: #d4af37;
      font-family: 'Arial Black', sans-serif;
      letter-spacing: 1px;
    }

    #sound-overlay .box p {
      font-weight: 700;
      color: #333;
      margin-bottom: 14px;
      line-height: 1.35;
    }

    #sound-overlay .box button {
      width: 100%;
      height: 52px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      font-size: 18px;
      font-weight: 900;
      background: linear-gradient(to right, #d4af37, #ffcc00);
    }

    body.tv #control-panel { display: none !important; }
  </style>
</head>

<body>
  <!-- Audio file: put sound.mp3 next to index.html -->
  <audio id="coinAudio" preload="auto" loop>
    <source src="sound.mp3" type="audio/mpeg">
  </audio>

  <!-- ADMIN -->
  <div id="control-panel">
    <div class="logo-control">Banda Vonyuchiy Veter</div>

    <div class="form-grid">
      <div class="field">
        <label for="employee">Employee</label>
        <select id="employee">
          <option value="">‚Äî Select Employee ‚Äî</option>
          <option value="Martin Jarosz">Martin Jarosz</option>
          <option value="Marko Kovac">Marko Kovac</option>
          <option value="Pan Oto">Pan Oto</option>
          <option value="Maros Vrtak">Maros Vrtak</option>
          <option value="Jan Kowalski">Jan Kowalski</option>
          <option value="Anna Kralova">Anna Kralova</option>
          <option value="Robert Moln√°r">Robert Moln√°r</option>
          <option value="Martin Nƒõmec">Martin Nƒõmec</option>
        </select>
      </div>

      <div class="field">
        <label for="country">Country / Geo</label>
        <select id="country">
          <option value="Czechia">Czechia</option>
          <option value="Slovakia">Slovakia</option>
        </select>
      </div>

      <div class="field">
        <label for="amountInput">Amount (USD)</label>
        <input type="number" id="amountInput" placeholder="e.g. 1500" min="1" step="1" inputmode="numeric" />
        <div class="hint">>= 5,000 ‚Üí more coins | >= 10,000 ‚Üí HUGE rain</div>
      </div>

      <button id="showBtn" type="button">üöÄ Show on TV</button>

      <div class="admin-status" id="adminStatus">
        Open TV: <b>?tv=1</b> (same browser, same PC).
      </div>
    </div>
  </div>

  <!-- TV -->
  <div id="alert-screen">
    <div id="particles"></div>
    <div class="content">
      <div class="logo-alert">Banda Vonyuchiy Veter</div>
      <div id="manager-name">Waiting‚Ä¶</div>
      <div id="amountDisplay">‚Äî</div>
      <div id="geo">‚Äî</div>
    </div>
  </div>

  <!-- Sound overlay -->
  <div id="sound-overlay">
    <div class="box">
      <h2>Enable Sound</h2>
      <p>
        Browser blocked autoplay. Click once on the TV window to enable sound.
        Make sure <b>sound.mp3</b> is —Ä—è–¥–æ–º —Å <b>index.html</b>.
      </p>
      <button id="enableSoundBtn" type="button">üîä Enable sound</button>
    </div>
  </div>

  <script>
    const isTV = new URLSearchParams(location.search).get('tv') === '1';
    if (isTV) document.body.classList.add('tv');

    const ALERT_MS = 8000;
    const STORAGE_KEY = 'bvv_money_alert_payload_v4';

    let autoCloseTimer = null;

    const coinAudio = document.getElementById('coinAudio');

    // WebAudio "booster" (–º–æ–∂–µ—Ç –¥–∞—Ç—å –≥—Ä–æ–º—á–µ, —á–µ–º –æ–±—ã—á–Ω—ã–π volume)
    let audioCtx = null;
    let boostedSource = null;
    let gainNode = null;

    function showSoundOverlay(show) {
      document.getElementById('sound-overlay').style.display = show ? 'flex' : 'none';
    }

    async function setupBoostIfNeeded() {
      // –ü–æ–¥–∫–ª—é—á–∞–µ–º <audio> –∫ WebAudio –∏ —á—É—Ç—å —É—Å–∏–ª–∏–≤–∞–µ–º
      // –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ user gesture ‚Äî –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ play.
      if (audioCtx) return;
      try {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        boostedSource = audioCtx.createMediaElementSource(coinAudio);
        gainNode = audioCtx.createGain();
        gainNode.gain.value = 1.6; // —É—Å–∏–ª–µ–Ω–∏–µ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ: –º–æ–∂–µ—Ç –±—ã—Ç—å –≥—Ä–æ–º–∫–æ/–∫–ª–∏–ø–ø–∏–Ω–≥)
        boostedSource.connect(gainNode);
        gainNode.connect(audioCtx.destination);
      } catch (e) {
        // –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏–º, –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–π volume=1
      }
    }

    async function tryPlayLoopAudio() {
      try {
        await setupBoostIfNeeded();

        coinAudio.loop = true;
        coinAudio.volume = 1.0; // –º–∞–∫—Å–∏–º—É–º
        coinAudio.currentTime = 0;

        // resume AudioContext if suspended
        if (audioCtx && audioCtx.state === 'suspended') {
          await audioCtx.resume();
        }

        await coinAudio.play();
        showSoundOverlay(false);
        return true;
      } catch (e) {
        showSoundOverlay(true);
        return false;
      }
    }

    function stopLoopAudio() {
      try { coinAudio.pause(); coinAudio.currentTime = 0; } catch {}
    }

    function formatUsd(amountNumber) {
      return `$${amountNumber.toLocaleString('en-US')} USD`;
    }

    function weightedPick() {
      const types = [
        { cls: 'btc',  text: '‚Çø', w: 5 },
        { cls: 'usdt', text: '‚ÇÆ', w: 4 },
        { cls: 'eth',  text: 'Œû', w: 4 },
        { cls: 'coin', text: 'ü™ô', w: 3 },
      ];
      const pool = [];
      for (const t of types) for (let i = 0; i < t.w; i++) pool.push(t);
      return pool[Math.floor(Math.random() * pool.length)];
    }

    function createParticlesByAmount(amount) {
      const container = document.getElementById('particles');
      container.innerHTML = '';

      // –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      let count = 60;
      let minSize = 22, maxSize = 48;
      let minDur = 4.6, maxDur = 7.0;

      // >= 5000: –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç
      if (amount >= 5000) {
        count = 95;
        minSize = 24; maxSize = 56;
        minDur = 4.2; maxDur = 6.4;
      }

      // >= 10000: –æ–≥—Ä–æ–º–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –∏ –ø—Ä—è–º –¥–æ–∂–¥—å
      if (amount >= 10000) {
        count = 140;
        minSize = 44; maxSize = 92;
        minDur = 3.8; maxDur = 5.6;
      }

      for (let i = 0; i < count; i++) {
        const t = weightedPick();

        const particle = document.createElement('div');
        particle.className = 'particle';

        const coin = document.createElement('div');
        coin.className = `coin ${t.cls}`;

        // huge styling for >=10000
        if (amount >= 10000) coin.classList.add('huge');

        // random 3D tilt per coin
        const rx = (8 + Math.random() * 18).toFixed(1) + 'deg';
        const ry = (-18 + Math.random() * 36).toFixed(1) + 'deg';
        coin.style.setProperty('--rx', rx);
        coin.style.setProperty('--ry', ry);

        const span = document.createElement('span');
        span.textContent = t.text;

        coin.appendChild(span);
        particle.appendChild(coin);

        const size = (minSize + Math.random() * (maxSize - minSize));
        coin.style.setProperty('--size', size.toFixed(0) + 'px');

        particle.style.left = (Math.random() * 100) + 'vw';
        particle.style.animationDelay = (Math.random() * 3.6) + 's';

        const dur = (minDur + Math.random() * (maxDur - minDur));
        particle.style.animationDuration = dur.toFixed(2) + 's';

        const drift = (-30 + Math.random() * 60);
        particle.style.setProperty('--drift', drift.toFixed(0) + 'px');

        const rot = (240 + Math.random() * 680) * (Math.random() < 0.5 ? -1 : 1);
        particle.style.setProperty('--rot', rot.toFixed(0) + 'deg');

        container.appendChild(particle);
      }
    }

    async function renderAlert(payload) {
      document.getElementById('manager-name').textContent = payload.name || '‚Äî';
      document.getElementById('amountDisplay').textContent = formatUsd(payload.amount || 0);
      document.getElementById('geo').textContent = payload.country || '‚Äî';

      document.getElementById('alert-screen').style.display = 'flex';

      createParticlesByAmount(payload.amount || 0);
      await tryPlayLoopAudio();

      if (autoCloseTimer) clearTimeout(autoCloseTimer);
      autoCloseTimer = setTimeout(goBack, ALERT_MS);
    }

    function goBack() {
      stopLoopAudio();

      if (isTV) {
        document.getElementById('alert-screen').style.display = 'flex';
        document.getElementById('manager-name').textContent = 'Waiting‚Ä¶';
        document.getElementById('amountDisplay').textContent = '‚Äî';
        document.getElementById('geo').textContent = '‚Äî';
      } else {
        document.getElementById('alert-screen').style.display = 'none';
        document.getElementById('control-panel').style.display = 'block';
      }
    }

    function sendToTV(payload) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    }

    function showAlertFromAdmin() {
      const name = document.getElementById('employee').value;
      const country = document.getElementById('country').value;
      const raw = document.getElementById('amountInput').value;

      if (!name) { alert("Please select employee."); return; }

      const amount = Number.parseInt(raw, 10);
      if (!Number.isFinite(amount) || amount <= 0) {
        alert("Please enter a valid amount (integer, >= 1).");
        return;
      }

      const payload = { name, country, amount, ts: Date.now() };
      sendToTV(payload);

      document.getElementById('adminStatus').textContent =
        `Sent to TV: ${name} ‚Äî ${formatUsd(amount)} ‚Äî ${country}`;
    }

    function onStorageEvent(e) {
      if (e.key !== STORAGE_KEY || !e.newValue) return;
      try {
        const payload = JSON.parse(e.newValue);
        if (!payload || !payload.ts) return;
        renderAlert(payload);
      } catch {}
    }

    document.getElementById('enableSoundBtn').addEventListener('click', () => {
      tryPlayLoopAudio();
    });

    if (isTV) {
      document.getElementById('alert-screen').style.display = 'flex';
      document.getElementById('control-panel').style.display = 'none';
      window.addEventListener('storage', onStorageEvent);

      // –∫–ª–∏–∫ –ø–æ –¢–í –æ–∫–Ω—É ‚Äî —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–≤—É–∫/–∞—É–¥–∏–æ-–∫–æ–Ω—Ç–µ–∫—Å—Ç
      document.body.addEventListener('click', () => {
        tryPlayLoopAudio();
      }, { once: true });

      // –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ (–µ—Å–ª–∏ –±—ã–ª–æ –Ω–µ–¥–∞–≤–Ω–æ)
      try {
        const existing = localStorage.getItem(STORAGE_KEY);
        if (existing) {
          const payload = JSON.parse(existing);
          if (payload && payload.ts && (Date.now() - payload.ts) < 5 * 60 * 1000) {
            renderAlert(payload);
          }
        }
      } catch {}

    } else {
      document.getElementById('alert-screen').style.display = 'none';
      document.getElementById('showBtn').addEventListener('click', showAlertFromAdmin);
      document.getElementById('amountInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') showAlertFromAdmin();
      });
    }
  </script>
</body>
</html>
